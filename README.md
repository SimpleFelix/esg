# ESG

ESG is short for Error Struct Generator.

It only generates Go source code recently.

### Scene

Sometimes developer need to send a JSON to the client. There are error code and error description within the payload.

```json
{
  "error": {
    "code": "InvalidPhone",
    "desc": "abc123 is not valid phone number."
  }
}
```

ESG can generate an `error` type source code with both Code and Description.

### Build

`go build -o esg`

### Usage

`./esg language arguments`

### Go Usage

`./esg go output_dir pkg_name error_code formatted_message [name_of_arguments..]`

### Example

`./esg go . errors InvalidPhone '%v is not a valid phone number.' phone`

The generated file is at `./InvalidPhone.go`

The source code looks like below.

```go
// Generated by ESG at 2006-01-02 15:04:05. github.com/SimpleFelix/esg

package errors

import "fmt"

type InvalidPhone struct {
	phone interface{}
}

// ErrorCode change it as you prefer.
func (e InvalidPhone) ErrorCode() interface{} {
	return "InvalidPhone"
}

// StatusCode refers to http response status code.
// Developer may want to set response status code based on error.
// For example, if the error is caused by bad request, then change the return value to 400.
// Ignore this function if no need for your project.
func (e InvalidPhone) StatusCode() int {
	return 500
}

// Error implementation to error interface.
func (e InvalidPhone) Error() string {
	return fmt.Sprintf(`%v is not a valid phone number.`, e.phone)
}

// ErrInvalidPhone is convenient constructor.
func ErrInvalidPhone(phone interface{}) InvalidPhone {
	return InvalidPhone{
		phone: phone,
	}
}
```

#### Example of Using Error Struct

```go
package errors

func brilliantlyValidate(phone string) error {
	if len(phone) > 100 {
        return ErrInvalidPhone(phone)
	}
	return nil
}
```

### Interface

ESG provides a common interface `ErrorType` developer may need.

#### Go

Import ESG module to your project. ESG module requires no dependency so far.

```go
package awesome

import "github.com/SimpleFelix/esg"

type ErrorPayload struct {
	Code interface{} `json:"code,omitempty"`
	Desc string      `json:"desc"`
}

func Handle(err esg.ErrorType) {
	if err == nil {
		response(200, nil)
		return
	}
	payload := ErrorPayload{
		Code: err.ErrorCode(),
		Desc: err.Error(),
	}
	response(
		err.StatusCode(),
		map[string]interface{}{
			"error": payload,
		},
	)
}
```

